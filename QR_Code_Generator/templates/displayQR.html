<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Your QR Code</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='displayQR.css') }}" />
  </head>
  <body>
    <main class="container">
      <section class="card">
        <header class="head">
          <h1>Your QR Code</h1>
          <p class="sub">Scan it or download it for later.</p>
        </header>

        <!-- If your backend serves a URL: set {{ qr_url }} -->
        <!-- Example Flask/Jinja: <img id="qrImage" src="{{ qr_url }}" alt="Generated QR code" /> -->
        <!-- If you serve base64: set {{ qr_data_url }} like "data:image/png;base64,..." -->
        <!-- Example: <img id="qrImage" src="{{ qr_data_url }}" alt="Generated QR code" /> -->

        <div class="preview">
          <img id="qrImage" src="{{ qr_url or qr_data_url }}" alt="Generated QR code" />
        </div>

        <div class="actions">
          <a id="downloadBtn" class="btn" href="#" download="qr-code.png">Download PNG</a>
          <button id="copyLinkBtn" class="btn btn-secondary" type="button">Copy Image Link</button>
        </div>

        <footer class="foot">
          <a class="link" href="/">← Generate another</a>
        </footer>
      </section>
    </main>

    <script>
      (function () {
        const img = document.getElementById("qrImage");
        const dl = document.getElementById("downloadBtn");
        const copyBtn = document.getElementById("copyLinkBtn");

        function updateDownload() {
          if (!img || !img.src) return;
          dl.href = img.src;
          // Suggest a better filename if query param like ?filename=... exists
          try {
            const url = new URL(window.location.href);
            const fname = url.searchParams.get("filename");
            if (fname) dl.setAttribute("download", fname.endsWith(".png") ? fname : fname + ".png");
          } catch (_) {}
          dl.classList.add("ready");
        }

        if (img.complete) updateDownload();
        else img.addEventListener("load", updateDownload);

        copyBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(img.src);
            copyBtn.textContent = "Copied!";
            setTimeout(() => (copyBtn.textContent = "Copy Image Link"), 1500);
          } catch {
            copyBtn.textContent = "Couldn’t copy";
            setTimeout(() => (copyBtn.textContent = "Copy Image Link"), 1500);
          }
        });
      })();
    </script>
  </body>
</html>
